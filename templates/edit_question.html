<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Question</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body class="bg-light">
<div class="container mt-5">

  <h2 class="mb-4">🛠️ Edit Question</h2>

  {% if question.edit_count %}
    <div class="mb-3 text-muted">✏️ {{ question.edit_count }} Edits Done</div>
  {% endif %}

  <form method="POST">
    <input type="hidden" name="stay_on_page" id="stay_on_page" value="no">

    <div class="mb-3">
      <label class="form-label">Question</label>
      <textarea name="question" class="form-control" rows="3" required>{{ question.question }}</textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Answer (Markdown + LaTeX Supported)</label>
      <textarea name="answer" id="answerInput" class="form-control" rows="8" required>{{ question.answer }}</textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Live Preview:</label>
      <div id="preview" class="border rounded p-3 bg-white" style="min-height:100px;"></div>
    </div>

    <div class="mb-3">
      <label class="form-label">YouTube Video URL</label>
      <input type="text" name="video_url" class="form-control" value="{{ question.video_url or '' }}">
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-success" onclick="document.getElementById('stay_on_page').value='no';">💾 Save</button>
      <button type="submit" class="btn btn-primary" onclick="document.getElementById('stay_on_page').value='yes';">💾 Save and Continue Editing</button>
      <a href="{{ url_for('view_questions') }}" class="btn btn-secondary">↩️ Cancel</a>
      <a href="{{ url_for('delete_question', id=question.id) }}" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this question?');">🗑️ Delete</a>
    </div>

  </form>
</div>

<script>
function renderPreview() {
  const content = document.getElementById('answerInput').value;
  document.getElementById('preview').innerHTML = marked.parse(content);
  MathJax.typeset();
}

document.getElementById('answerInput').addEventListener('input', renderPreview);

window.onload = function() {
  renderPreview();  // Render existing answer
};
</script>

</body>
</html>
